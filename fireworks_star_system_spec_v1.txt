花火ゲーム：星（Star）システム仕様書 v1.0
作成日: 2026-01-30

============================================================
0. この仕様書の前提（重要）
============================================================
- 本仕様書は「花火の見え方」をゲームで再現するための VFX/挙動仕様です。
- 現実の花火を製造・再現するためのレシピ、配合、工作手順、施工方法は扱いません。
- ここでいう「層（Layer）」は物理的な製造層ではなく、ゲーム内の“時間順に発火する見え方モジュール”
  （＝エフェクトスタック / 演出スタック）を指します。

============================================================
1. 目的 / スコープ
============================================================
- 星（Star）の「見え方」を、(1) 種類分類、(2) 部品（層）ライブラリ、(3) 組み立て表（推奨スタック）
  の3点で統一し、実装・データ駆動化（スプレッドシート/JSON化）しやすくする。

============================================================
2. 用語
============================================================
- 星（Star）:
  打ち上げ後の開花を構成する個々の発光体（ゲームではパーティクル要素/スプライト要素単位）。
- 見え方の核（Kernel）:
  「尾がある/垂れる/明滅する/割れる」など、色ではなく現象の中心となる見え方。
- 色（Color）:
  基本はパラメータ扱い。赤/青/緑…などはカテゴリ分けせず、同一モジュールに対する色差分とする。
- Prime（起動）:
  星スタックの開始トリガ（点火フラッシュ/開始スパーク等の最小演出）。実装上の“開始保証”。

【注意】Ghost（ゴースト）という語は英語圏で別概念（ゴーストシェル等）にも使われやすい。
本仕様では「消えそうで消えない青白い弱光」は Afterglow（残光）として扱う。

============================================================
3. 星の分類（色違いは統合）
============================================================
表記:
- 星の種類: ゲーム内カテゴリ名
- 見え方の核: 色以外で区別する現象
- 色: 代表的な色傾向（基本はパラメータ）
- 星の詳しい呼び名: UI/図鑑/自動命名に使う名称

[分類一覧]
1) 尾なし単色（Peony/牡丹系）
   - 核: その場で光って消える（尾ほぼ無し）
   - 色: 色だけ差し替え（赤/青/緑/黄/紫/橙/レモン/水色/ピンクなど）
   - 呼び名例: 紅星/青星/緑星/…（全部ここ）

2) 照明星（Illumination / Flare）
   - 核: 色より光度・燃焼時間が主目的（照明・信号）
   - 色: 白/黄が主（パラメータ化可）
   - 呼び名: 照明星（Flare）

3) 菊引き（Chrysanthemum “引”）
   - 核: 星が中心から尾を引いて放射状に伸びる
   - 色: 尾は炭火色/金系など（パラメータ扱いだが“尾タイプ”が主）
   - 呼び名: 「菊（引）」系、引先○○の“尾”側

4) 冠菊/柳引き（Kamuro/Willow “垂れ”）
   - 核: 尾が長く垂れ下がって落ちる（地上へ垂れる系）
   - 色: 金/銀/炭火など
   - 呼び名: 柳星、冠菊/錦冠菊/銀冠菊の“垂れ”

5) 和火尾（Wabi tail：渋い炭火尾）
   - 核: 明るさ控えめで“渋い”炭火尾（情緒系）
   - 色: 炭火色
   - 呼び名: 和火（Wabi）系（※一般的な炭火尾より暗く渋い表現）

6) 虎の尾（Tiger Tail：煙感が強い太尾）
   - 核: 極太で煤っぽい尾、煙感が強い
   - 色: 赤茶〜黒赤（表現上）
   - 呼び名: 虎の尾（Tiger Tail）

7) 錦/ブロケード金尾（Brocade：金の長尾）
   - 核: 明るい金色の長い尾（豪華）
   - 色: 金系
   - 呼び名: 錦星（Nishiki）／黄金星（短尾版もここ）／錦冠菊の金要素

8) 砂金（Gold dust：微細金尾）
   - 核: “サラサラ”した短く細かい金の尾
   - 色: 金系
   - 呼び名: 砂金星（Sakin）

9) 銀引（Silver line：鋭い銀尾）
   - 核: 銀色の鋭い直線・シャープ
   - 色: 銀系
   - 呼び名: 銀引（Gin-biki）

10) 銀冠（Silver Kamuro：銀の垂れ尾）
   - 核: “銀の柳”みたいに垂れる
   - 色: 銀系
   - 呼び名: 銀冠（Gin-kamuro）

11) 鉄火/鉄粉（Iron sparks：枝分かれ火花）
   - 核: オレンジ系火花が枝分かれする
   - 色: 金橙系
   - 呼び名: 鉄粉星/鉄火、松葉の“枝分かれ感”の核

12) グラナイト/スプレッダー（Granite/Spreader）
   - 核: ざらついた独特の火花＋煙っぽさ／広がり
   - 色: 青緑〜緑白が語られがち（パラメータ）
   - 呼び名: 苔/グラナイト（Granite）

13) グリッター（Glitter：遅れて瞬く粒）
   - 核: 遅れてキラキラ（時間遅れの瞬き）
   - 色: 金/銀が主
   - 呼び名: きらら（Kirara/Glitter）、金グリッター/銀グリッター

14) フリッター/スパンコール（Flitter/Spangle）
   - 核: 星そのものが毛羽立つ/金属片が鋭く光る（表面きらめき）
   - 色: 金/銀が主
   - 呼び名: 金フリッター/銀フリッター、スパンコール

15) ストロボ（Strobe：明滅）
   - 核: 一定周期でピカピカ明滅
   - 色: 白/赤/緑など（パラメータ）
   - 呼び名: 点滅星（Strobe）

16) クラックル（Crackle：微小破裂）
   - 核: パチパチ音＋閃光粒が飛ぶ
   - 色: 金銀っぽいことが多い（表現上）
   - 呼び名: 爆裂星（Crackle / Dragon Egg）

17) クロセット（Crossette：分裂）
   - 核: 燃焼途中で複数方向に割れて飛ぶ
   - 色: 色は載せ替え可
   - 呼び名: クロセット（Crossette）

18) 落葉（Falling leaves：ゆっくり落ちる）
   - 核: ゆらゆら・減速して落ちる挙動
   - 色: 色は載せ替え可
   - 呼び名: 落葉（Ochiba）

19) Afterglow（残光：青白い弱光）
   - 核: 消えそうで消えない青白い弱光（弱い残光）
   - 色: 青白系
   - 呼び名: 残光（Afterglow）／幽霊火（和名UIでは可）

20) 変色（Color change：層切替）
   - 核: 燃え進むと色が切り替わる（2〜数回）
   - 色: 色の順番が設計
   - 呼び名: 変色星、引先紅/引先青（“尾の種類”＋“先端の色層”）

============================================================
4. 星の部品（層）ライブラリ：全モジュール一覧
============================================================
「必要な層」を選んで星（Star）に割り当てる。

表記:
- 部品（層）名: モジュール名（実装IDとしても使用可）
- 役割: 何を決める層か
- 対応分類: 上記「星の分類」のどの核に効くか
- 典型位置: スタック上の目安（時間順/優先順）

[構造・制御モジュール（見え方ほぼ無し）]
- Core / 芯（核）
  役割: 星の土台。寿命、基本サイズ、基準密度など。
  対応分類: すべて
  典型位置: Core

- Body coat / 充填・肉付け層
  役割: 星を太らせる“汎用肉付け”（エフェクト層の台）。
  対応分類: なし（構造）
  典型位置: Layer群の下支え（実装上はパラメータ）

- Adhesion coat / 接着・下地層
  役割: 次の層を安定して載せる（剥離防止）。ゲームでは「安定係数/発火率」を調整する枠。
  対応分類: なし（制御）
  典型位置: 層間

- Delay / 暗火（ディレイ）
  役割: 点火タイミングを遅らせる（見え方ほぼ無しで“間”を作る）。
  対応分類: 変色/合成の間
  典型位置: 中間

- Barrier / Blind（遮光・断熱・隔離）
  役割: 混色/暴走防止。ゲームでは「前段の残光を一旦落とす」「色にじみを抑える」。
  対応分類: 変色/複合
  典型位置: 層間

- Seal coat / 保護・シール層
  役割: 外装保護。ゲームでは「風耐性/湿気耐性」等のステータス枠。
  対応分類: なし
  典型位置: Prime外（メタ情報）

[起動モジュール（開始保証）]
- Prime / 化粧（通常プライム）
  役割: 着火性の安定・耐風性。ゲームでは開始の最小スパーク/フラッシュ。
  対応分類: すべて
  典型位置: Prime（最後に付与）

- Starter / Starting fire
  役割: 難起動スタックを確実に開始。ゲームでは「開始失敗率を下げる」。
  対応分類: 高負荷演出（ストロボ/クラックル等）
  典型位置: Prime寄り（任意）

- Dark prime / Changing relay（つなぎ）
  役割: 色変化の境界を“暗く”作る（混色区間を隠す）。ゲームでは切替の“黒味/暗転”。
  対応分類: 変色
  典型位置: 色層の間

[発光（色）モジュール]
- Steady Color（高輝度）色層
  役割: “点で一定発光”の色を作る。色はパラメータ。
  対応分類: 尾なし単色（牡丹系）
  典型位置: Layer1〜

- Steady Color（低輝度/渋色）色層
  役割: 暗め・深い色調の定常発光（雰囲気が違う）。
  対応分類: 尾なし渋色
  典型位置: Layer1〜

- Illumination / Flare層
  役割: 色より光度・持続（照明/信号）。
  対応分類: 照明星
  典型位置: Layer1〜

[尾（trail）モジュール]
- Chrysanthemum tail / 菊引き尾層
  役割: 放射状の“引き”尾。
  対応分類: 菊引き
  典型位置: 外側寄り（Layer1〜2）

- Willow/Kamuro tail / 柳・冠尾層
  役割: 長く垂れる尾。
  対応分類: 冠菊/柳
  典型位置: 外側寄り

- Wabi tail / 和火尾層
  役割: 渋く暗い炭火尾。
  対応分類: 和火尾
  典型位置: 外側寄り

- Tiger tail / 虎の尾層
  役割: 極太・煤っぽい尾（煙感が主役）。
  対応分類: 虎の尾
  典型位置: 外側寄り

- Brocade/Gold tail / 錦（金尾）層
  役割: 明るい金尾（豪華な長尾）。
  対応分類: 錦系
  典型位置: 外側寄り

- Gold dust / 砂金層
  役割: 微細でサラサラした短い金尾。
  対応分類: 砂金
  典型位置: 外側寄り

- Silver line / 銀引層
  役割: 鋭い銀色の直線尾。
  対応分類: 銀引
  典型位置: 外側寄り

- Silver kamuro / 銀冠層
  役割: 銀の“垂れ尾”（銀の柳）。
  対応分類: 銀冠
  典型位置: 外側寄り

[火花・きらめき・点滅・破裂モジュール]
- Iron sparks / 鉄火・鉄粉層
  役割: 枝分かれ火花（線香花火感）。
  対応分類: 鉄火/鉄粉
  典型位置: 外側寄り

- Granite/Spreader / 亜鉛グラナイト層
  役割: ざらついた独特の火花・広がり・煙っぽさ。
  対応分類: グラナイト
  典型位置: 外側寄り

- Glitter / グリッター層
  役割: 遅れてキラキラ（遅延フラッシュ）。
  対応分類: グリッター
  典型位置: 外側〜中間

- Tremolant / トレモラン層
  役割: グリッターのロング持続版。
  対応分類: グリッター（長持続）
  典型位置: 外側〜中間

- Flitter/Spangle / フリッター・スパンコール層
  役割: 金属片っぽい鋭い瞬き／毛羽立つ光。
  対応分類: フリッター/スパンコール
  典型位置: 外側

- Firefly overlay / ファイヤーフライ層
  役割: 尾の中に点がピカピカ混ざる（合成用オーバーレイ）。
  対応分類: 尾（T/M）＋微細きらめき
  典型位置: 外側

- Strobe / 点滅層
  役割: 周期的な明滅（暗期⇔閃光期）。
  対応分類: ストロボ
  典型位置: 外側〜中間

- Crackle / クラックル層
  役割: 微小破裂のパチパチ＋閃光粒。
  対応分類: クラックル
  典型位置: 内側〜外側

[挙動モジュール]
- Crossette split module / 分裂制御モジュール
  役割: 途中で分裂させる“割れ”設計（挙動）。
  対応分類: クロセット
  典型位置: 内部（効果層とセット）

- Falling Leaves drift module / 落葉挙動モジュール
  役割: ふわっと漂って落ちる（減速・揺らぎ）。
  対応分類: 落葉
  典型位置: 外側

[残光・終端モジュール]
- Afterglow / 残光層
  役割: 弱い青白・消えそうで消えない残光。
  対応分類: Afterglow（幽霊火）
  典型位置: 外側〜中間

- Terminal flash / 光露（終端フラッシュ）層
  役割: 消え際に“ピカッ”と立ち上げる終端属性。
  対応分類: 任意
  典型位置: 終端側

- Terminal slow-fade / 降雪（ゆっくり消える）層
  役割: 消え方を遅くする（綿雪っぽい）。
  対応分類: 任意
  典型位置: 終端側

============================================================
5. 組み立てルール（データ設計）
============================================================
5.1 スタックの基本
- StarDef は以下の要素を持つ:
  - Core（必須）
  - Layers（0..N、推奨は最大6。拡張可）
  - Prime（原則必須）
  - Params（色・寿命・強度などのパラメータ）

- Layers は時間順（タイムライン）に評価される。
- “色”は原則 Params.color（または colorA/colorB/...）で差し替え。
- “尾の種類”がカテゴリ差（T/M系）を決め、色は尾に対するパラメータ。

5.2 合成ルール（推奨）
- 尾（T/M系） + Firefly overlay（任意） → 「尾の中で点が瞬く」合成が可能。
- Brocade（錦金尾） + Glitter/Flitter（任意） → 「豪華＋きらめき増し」。
- 変色は (ColorA -> Dark prime -> ColorB) を基本単位とし、段数分だけ繰り返す。

5.3 Prime の扱い
- 原則、全Starに Prime を付与（最小フラッシュ/開始スパーク）。
- 高負荷演出（ストロボ/クラックル等）は Starter を併用してもよい（開始安定用のパラメータ）。

============================================================
6. 星タイプ別：推奨スタック表（時間順）
============================================================
列:
星の名前 | Core | Layer1 | Layer2 | Layer3 | Layer4 | Layer5 | Layer6 | Prime | 光り方メモ
※「—」は空（未使用）。

------------------------------------------------------------
A) ベース発光・変色系
------------------------------------------------------------
[1] 尾なし単色（Peony/牡丹系）
  Core: Core/芯
  L1 : Steady Color（高輝度）
  L2 : —
  L3 : —
  L4 : —
  L5 : Terminal slow-fade（任意）
  L6 : —
  Prime: Prime
  メモ: 色差分はパラメータ（赤/青/緑/…）

[2] 尾なし渋色（渋い定常）
  Core: Core/芯
  L1 : Steady Color（低輝度/渋色）
  L2 : —
  L3 : —
  L4 : —
  L5 : Terminal slow-fade（任意）
  L6 : —
  Prime: Prime
  メモ: “渋さ”は色層タイプで表現（彩度/明度/減衰）

[3] 照明星（Flare）
  Core: Core/芯
  L1 : Illumination / Flare層
  L2 : —
  L3 : —
  L4 : —
  L5 : Terminal slow-fade（任意）
  L6 : —
  Prime: Prime
  メモ: 高輝度・長持続を優先。色は任意（白/黄が典型）

[4] 変色（2段）
  Core: Core/芯
  L1 : Steady Color（色A）
  L2 : Dark prime（つなぎ）
  L3 : Steady Color（色B）
  L4 : —
  L5 : Terminal flash / slow-fade（任意）
  L6 : —
  Prime: Prime
  メモ: 変化を“キレよく”見せたい場合、つなぎの暗転を強める

[5] 変色（3段以上）
  Core: Core/芯
  L1 : Steady Color（色A）
  L2 : Dark prime（つなぎ）
  L3 : Steady Color（色B）
  L4 : Dark prime（つなぎ）
  L5 : Steady Color（色C）
  L6 : （必要なら追加スロットで拡張）
  Prime: Prime
  メモ: 段数が多いほど「暗つなぎ」が効く。表の拡張を許容する

[6] 引先○○（尾＋先端色）
  Core: Core/芯
  L1 : （尾：Chrysanthemum / Willow / Wabi / Tiger / Brocade / Gold dust / Silver line / Silver kamuro のいずれか）
  L2 : Dark prime（つなぎ）
  L3 : Steady Color（先端色）
  L4 : —
  L5 : Terminal flash（任意）
  L6 : —
  Prime: Prime
  メモ: “尾タイプ”が核、先端色はパラメータ。玉名生成に向く

[7] Afterglow（幽霊火/残光）
  Core: Core/芯
  L1 : Afterglow / 残光層
  L2 : Terminal slow-fade（推奨）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 弱い青白・消えそうで消えない。UI名は「幽霊火」でも可

------------------------------------------------------------
B) 尾（trail）系
------------------------------------------------------------
[8] 菊引き（Chrysanthemum “引”）
  Core: Core/芯
  L1 : Chrysanthemum tail / 菊引き尾層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 放射状の尾。色は尾パラメータ（炭火/金など）

[9] 冠菊/柳引き（垂れ）
  Core: Core/芯
  L1 : Willow/Kamuro tail / 柳・冠尾層
  L2 : Firefly overlay（任意）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 長い垂れ尾。Fireflyで尾の中に点滅粒を混ぜられる

[10] 和火尾（渋い炭火尾）
  Core: Core/芯
  L1 : Wabi tail / 和火尾層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 明度低め・残り香のある尾（ゲーム内演出として差別化）

[11] 虎の尾（太尾・煙感）
  Core: Core/芯
  L1 : Tiger tail / 虎の尾層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: “煤っぽさ”を粒子密度/煙パラメータで表現

[12] 錦/ブロケード金尾（豪華）
  Core: Core/芯
  L1 : Brocade/Gold tail / 錦（金尾）層
  L2 : Glitter または Flitter（任意）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 豪華さ優先。きらめき追加で「錦先〜」系の表現にも寄せられる

[13] 砂金（微細金尾）
  Core: Core/芯
  L1 : Gold dust / 砂金層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: “さらさら短尾”を粒径/寿命/抵抗で表現

[14] 銀引（鋭い銀尾）
  Core: Core/芯
  L1 : Silver line / 銀引層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 直線・シャープさ（ブラー少なめ/線状パーティクル）

[15] 銀冠（銀の垂れ尾）
  Core: Core/芯
  L1 : Silver kamuro / 銀冠層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 銀の柳。銀引より柔らかく垂れる方向

------------------------------------------------------------
C) 火花・きらめき・点滅・破裂系
------------------------------------------------------------
[16] 鉄火/鉄粉（枝分かれ火花）
  Core: Core/芯
  L1 : Iron sparks / 鉄火・鉄粉層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 枝分かれ感（分岐パラメータ/火花の“ほぐれ”）

[17] グラナイト/スプレッダー
  Core: Core/芯
  L1 : Granite/Spreader / 亜鉛グラナイト層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: “荒い火花＋煙っぽさ”を密度と拡散で表現

[18] グリッター（遅れて瞬く）
  Core: Core/芯
  L1 : Glitter / グリッター層
  L2 : Tremolant / トレモラン層（任意）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 遅延点滅粒。トレモランで長持続版へ

[19] フリッター/スパンコール（表面きらめき）
  Core: Core/芯
  L1 : Flitter/Spangle / フリッター層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 金属片っぽい鋭い閃き（ハイライト強め）

[20] ストロボ（明滅）
  Core: Core/芯
  L1 : Strobe / 点滅層
  L2 : （必要なら Steady Color を下地にしても良い）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 周期（Hz）とデューティ比で性格が変わる

[21] クラックル（パチパチ）
  Core: Core/芯
  L1 : Crackle / クラックル層
  L2 : —
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 破裂粒＋音。粒の数/遅延分布が体感を左右

------------------------------------------------------------
D) 挙動モジュール系
------------------------------------------------------------
[22] クロセット（分裂）
  Core: Core/芯
  L1 : （色 or 尾 いずれかのベース層）
  L2 : Crossette split module / 分裂制御
  L3 : （分裂後のサブ粒に Glitter/Crackle などを付与してもよい）
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: “割れるタイミング”と“分裂数/方向”が主役

[23] 落葉（ふわっと漂って落ちる）
  Core: Core/芯
  L1 : Falling Leaves drift module / 落葉挙動
  L2 : （色ベース任意：Steady Color など）
  L3 : —
  L4 : —
  L5 : —
  L6 : —
  Prime: Prime
  メモ: 減速・揺らぎ・空気抵抗で“落葉感”を作る

============================================================
7. データ項目（最低限）
============================================================
StarDef（例）
- id: string
- display_name: string（図鑑/表示名）
- category: enum（分類ID）
- core: module_id
- layers: [module_id]（最大6推奨、拡張可）
- prime: module_id
- params:
    - color / colorA / colorB ...
    - lifetime（基準）
    - size（基準）
    - intensity（基準）
    - trail_length / fall_speed / flicker_hz / crackle_count ...（モジュール依存）

============================================================
8. 変更履歴
============================================================
v1.0 (2026-01-30)
- 星の分類（色統合）と層ライブラリ、推奨スタック表を統合して仕様化。
- “幽霊火”の英語名は誤解回避のため Afterglow を推奨（UI表記は幽霊火/残光で可）。

（以上）
