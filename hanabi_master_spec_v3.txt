花火職人シミュレーター（仮）
総合仕様書 v3.0（外部共有用 / 1から読める版）
Date: 2026-01-16（Asia/Tokyo）

============================================================
0. このゲームが何か（超要約）
============================================================
・まったり創作（作品発表 7）：花火を「設計して」「作って」「打ち上げて眺める」職人シミュ
・金策イベント 3：依頼をこなし、お金と評判を稼いで工房を強化し、より大きな大会へ
・ゲーム内の制作は“花火っぽい挙動と職人感”の表現であり、危険物の現実工程・配合・手順は扱わない
・最終的な花火の再生は「自前シミュ（C#）＋Particle/VFX」で軽く・決定的に（再現性あり）
・プレイヤー体験の核：自分の配置（設計）が結果に因果で反映されること（納得感）

============================================================
1. 目標・方針
============================================================
1.1 目標
・2か月でSteamに出せるMVPを作る（初心者でも実装可能な構成に絞る）
・「花火作り → 試射（打ち上げ） → 評価 → 改善」のループを最速で完成させる
・将来的にVRChatへ“設計図（Blueprint）”を移植できる余地を残す

1.2 世界観・トーン
・雰囲気：カイロソフト＋陶芸マスター的（かわいく・軽く・まったり）
・会話：多少（味付け）。重要なストーリー依存はしない
・感情：プレイヤーに「すごいな」「きれいだな」を持ってほしい

1.3 重要な非採用（やらないこと）
・梱包／配送／在庫管理などの管理ゲー要素は入れない
・粒子同士の衝突、粒の地形衝突（Collision）は基本なし（花火らしさと軽さ優先）
・星1個ずつRigidbodyで飛ばす設計はしない（重い＆再現性が揺れる）

============================================================
2. 開発環境・技術方針
============================================================
2.1 エンジン
・Unity（PC / Steam）

2.2 描画・物理
・打ち上げ（上昇フェーズ）：簡易物理（重力・風・簡易抵抗）
・破裂後（開花フェーズ）：自前シミュ（C#でpos/vel/age更新）→ ParticleSystem or VFX Graphへ反映
・衝突なし（粒同士・地形ともに）
・風：少し入れる（煙が流れるのが重要）

2.3 再現性（決定性）
・乱数seed固定で「同じ設計図＝同じ花火」になる
・大会などでも同一作品の結果がブレにくい（評価の納得感）

============================================================
3. コアゲームループ（プレイヤーがやること）
============================================================
3.1 ループ（依頼あり）
ホーム
 → 依頼を見る（5件から選ぶ）
 → 制作（設計・粒詰め）
 → 試射（何度でも）
 → 提出
 → 評価（点数＋ランク＋内訳）
 → 報酬（お金／評判）
 → ホームへ

3.2 ループ（自由制作）
ホーム
 → 制作（自由）
 → 試射
 → 保存（図鑑へ）
 → ホームへ

3.3 大会（発表）
ホーム
 → 大会（カレンダーから選ぶ）
 → 演目（60秒）を実行（同時打ち最大5）
 → 大会評価
 → 評判が大きく増える（ドカン）

============================================================
4. 画面遷移（ナビ木構造）
============================================================
4.1 タイトル（Title）
・新規開始（→セーブ選択→初回チュートリアル→ホーム）
・続きから（→セーブ選択→ホーム）
・設定
・クレジット
・終了

4.2 ホーム（工房ハブ / Home）※主要ハブ
・依頼（Orders）
・制作（Workshop）
・大会（Festival）
・作品図鑑（Library）
・工房強化（Upgrades）
・設定（Settings）
・タイトルへ戻る

4.3 制作中の遷移
・Workshop → 試射（TestRange）→ Workshopへ戻る
・Workshop → 保存（命名）→ Library/Workshopへ
・依頼中：Workshop → 提出 → 評価（Judge）→ Home

============================================================
5. 依頼（Orders）
============================================================
5.1 依頼の提示
・常に5件提示（枠が埋まったら補充）
・依頼書UI：和紙っぽい1枚絵
　- 正面から見た構図（色・形の参考）
　- 立体絵（3D風の2D表現：ざっくり奥行き）
　- テキスト 2〜4行（意図：例「肩を揃えて、消え口まで上品に」）

5.2 依頼のパラメータ
・分類：割物／ぽか物／半割物（※ゲーム内分類）
・玉サイズ：小／中／大／特大（MVPは小〜大中心）
・最大色数：依頼ごとに変動（自由制作は最大16）
・重視軸（4軸の重み）：座り／盆／肩／消え口
・推奨：昇り方スイッチ（3種のどれが合いそうか）
・報酬：お金／評判
・制作費：失敗時は戻らない（損する）

5.3 受注
・MVP：受注枠1
・受注後は制作画面に依頼書を常時表示

5.4 難易度
・評判に応じて上がる
　- 条件数増加（色・雰囲気・粒タイプ指定）
　- 玉サイズUP（解像度UP）
　- 色数上限UP
　- マニアック粒タイプ要求（図鑑解放と連動）

============================================================
6. 制作（Workshop）— ゲームの核
============================================================
6.1 制作の設計方針
・初心者でも迷わない「Stepガイド（固定順）」をUIで提示
・Undo/Redoは必須（30手以上）
・リアル志向は“結果（見た目と評価）”で出す
・納得感のため「割薬を敷く／和紙で区切る／役物を入れる」をゲーム操作として再現する

6.2 制作開始フロー（UIで順番固定）
Step1：分類（割物／ぽか物／半割物）
Step2：型（テンプレ／フリー）
Step3：粒タイプ（爆発の仕方）
Step4：玉サイズ（依頼で固定 / 自由制作は選択）
Step5：昇り方スイッチ（3種）
Step6：色パレット設定（依頼上限内 / 自由は最大16）
Step7：中身を詰める（編集）
Step8：試射（何度でも）
Step9：命名→保存
Step10：依頼中なら提出

6.3 制作画面レイアウト（MVP）
左：依頼書 + 予測ゲージ（座り/盆/肩/消え口）
中央：設計パネル（分類/粒タイプ/色/昇り方/余韻/煙/キレ/コスト）
右：編集ビュー（Aスライス / B3Dフリー）+ ツール
右下：3D半透明プレビュー（常時：回転/ズーム）
下：試射/保存/提出/戻る/ヘルプ

============================================================
7. 粒詰めエディタ（2方式）
============================================================
7.1 A) スライス編集（2D）— MVP最優先
概要：
・内部を層（Zスライス）に分け、各層にグリッドで粒を置く（お絵描き寄り）
・層は最大5程度を目安（玉サイズにより変動）
・配置の形が結果に強く出る（リアル志向寄り）

操作（必須）：
・クリック配置
・ドラッグ連続配置
・消しゴム
・Undo/Redo（30手以上）
・層ごと削除

補助（必須）：
・放射対称（分割：1/8/12/16 など）
・オニオンスキン（前後層の薄表示）
・透明全体像（3D半透明プレビュー）

粒の選び方（決定）：
・「粒タイプ → 色」の順で選ぶ
・色は多色対応（依頼上限あり）

7.2 B) 3Dフリー編集（半球型）— 自由度枠（段階解放）
目的：
・グリッドだけでは再現が厳しい“ぽか物/分砲/らっきょう”などを吸収
・割薬・和紙・役物を直感操作で扱う

ビュー：
・半球の型（内部が見える）
・回転/ズーム/断面表示（任意高さでカット）
・表示切替（半透明 / 割薬密度ヒートマップ）

モード（同列）：
(1) グリッドモード（壁/和紙面にスタンプ）
　・右クリック押しながら左クリックでスタンプ、ドラッグ連続
(2) フリーモード（置く）
　・クリックで“落として置く” → 疑似物理で整列 → 最終的にVoxelに焼き付け
(3) 割薬モード（敷く/撒く）
　・案A：密度をブラシで塗る（実装が簡単）
　・案B：撒いて堆積（触感UP、コストUP）
(4) 和紙モード（区切り壁）
　・線/面を引いて区切り壁を作る → 壁にグリッド配置できる
(5) 役物モード（中に入れる）
　・分砲（小花火）/ らっきょう（塊）/ 吊物 / 煙玉 など（ゲーム表現）

共通ツール：
・Undo/Redo、消しゴム、スポイト、対称、ブラシサイズ、表示切替

テンプレ（型の違い）：
・割物/ぽか物/半割物は「初期ガイド（テンプレ）が置かれているだけ」
・操作はフリーと同じ（テンプレ = 入口の助け）

============================================================
8. データ設計（Blueprint と PackedVolume）
============================================================
8.1 2層設計の結論
・Blueprint（設計図）：作品として残す“意図”と“配置情報”を軽く保持（エンジン非依存寄り）
・PackedVolume（充填データ）：編集結果の3D表現（Voxel/密度場/和紙/役物）を圧縮保持
・派生量（割薬隣接、局所密度、遮蔽など）は保存しない → 再生時に計算（拡張性が高い）

8.2 Blueprint（例：最小〜拡張）
必須（MVPの芯）：
・version / name / seed
・玉サイズ（Small/Med/Large）
・粒タイプID
・色パレット（色数上限）
・星の骨格（点群：unit vector / 球面座標 / スライス）
・演出意図パラメータ（baseSpeed / uniformity / jitter / life / drag / wind など）

拡張（後で追加）：
・分類（割物/ぽか物/半割物/フリー）
・対称設定（分割数）
・昇り方スイッチ（3種）
・和紙/役物の参照（SubShellのBlueprint参照など）
・タグ/履歴/使用回数

8.3 PackedVolume（Voxel/密度場）
Voxel解像度（玉サイズで固定、最大 128^3 程度まで）：
・小：64^3
・中：96^3（任意）
・大：128^3

セル種別（最小構成）：
・Empty
・Star（色Index / starTypeId）※MVPでは“星サイズは作品内で1種類固定”
・Charge（割薬密度：0..255 byte推奨）
・Paper（和紙：wallId）
・Payload（役物：payloadId）

保存（軽量化）：
・Emptyが多い → RLE（連長圧縮）または 8^3チャンク圧縮が有効
・JSON＋base64＋gzip なども選択肢（実装コストと相談）

============================================================
9. 再生（BurstSolver → 自前シミュ → Particle/VFX）
============================================================
9.1 概要（流れ）
PackedVolume/Blueprint
 → BurstSolver（初期条件生成）
 → Sim（自前シミュ：pos/vel/age更新）
 → Renderer（ParticleSystem/VFXへ反映）
 → 画面演出（煙・風・音）

9.2 BurstSolver（因果の中核）
目的：
・現実の爆発を“物理的に解く”のではなく、
　プレイヤーが納得できる「詰め方 → 結果」の因果を作る

入力：
・星（位置/方向）
・割薬密度場（Charge）
・和紙（Paper）
・役物（Payload）
・環境（風/重力/抵抗）
・seed（決定性）

出力（粒ごとの初期条件）：
・pos0, vel0, life, color, tail, sparkle など

代表的な計算（例）：
・星の放射方向（dir）は星配置から決定
・勢い（speed）は割薬密度の寄与で変化
　- localChargeDensity：星近傍の密度平均
　- rayChargeIntegral：中心→星までの密度積分
・ムラ（jitter）は密度ムラ、星の混雑度、テンプレ補正で決定
・和紙の遮蔽/遅延（演出）：paperOcclusion を入れる余地
・役物は二次バースト（時間オフセット）として生成

9.3 自前シミュ（C#）
・1粒ずつRigidbodyを使わず、配列で更新（高速＆決定的）
更新例：
・v += g*dt
・v += wind*dt（少し）
・v += (-k*|v|*v)*dt（簡易抵抗）
・p += v*dt
・age += dt / life
・輝度カーブでalphaを制御（最初強→後半減衰）

9.4 Particle/VFX反映
・ParticleSystem.SetParticles で位置と色を反映（MVP）
・大量化するなら VFX Graph（GPU）に拡張
・Collision/Lightsは基本OFF（負荷＆意図と合わない）

============================================================
10. 試射（TestRange）
============================================================
10.1 目的
・改善ループを回すための場（何度でも試せる）
・“きれい”を邪魔しないUI量

10.2 画面
・夜空、風向きUI（小）、煙が流れる
・カメラ：回転/ズーム
・ボタン：リトライ、戻る

10.3 表示（最小）
・4軸ゲージ（座り/盆/肩/消え口）
・仮ランク
・短いヒント1行（例「中心が偏っているかも」）

10.4 フォトモード（+a）
・MVP：UI非表示＋ズームのみ（先に入れる価値が高い）

============================================================
11. 評価（Judge）— スコア軸
============================================================
11.1 出力
・点数（0..1000）
・ランク（S/A/B/C/D）
・4軸内訳（座り/盆/肩/消え口 0..100）
・依頼一致（0..200）
・品質補正（欠け/偏り/色数違反など）

11.2 4軸の定義（共通言語）
・座り：頂点（適切な高さ）で開く
・盆：真ん丸に開く（偏りが少ない）
・肩：放射が揃い筋がまっすぐ
・消え口：先端が揃って美しく消える

11.3 ランク閾値（初期案）
・S：900..1000
・A：750..899
・B：600..749
・C：450..599（失敗境界）
・D：0..449

11.4 失敗
・C以下は失敗扱い（制作費は戻らない）
・失敗作も図鑑に残る（“学び”になる）

============================================================
12. お金・評判・強化（Upgrades）
============================================================
12.1 経済の基本
・依頼：金が主、評判も少し
・大会：評判が主（ドカン）、金は少し
・制作費：失敗時に損する（緊張感）

12.2 工房強化の方針
・ほぼ線形でOK（迷わせない）
・快感は2つ：
　(1) 楽になる（作業効率UP）
　(2) 表現の幅が増える（新しい粒タイプ/色/演出）

12.3 強化カテゴリ（例）
効率系：
・Undo枠増加
・ブラシサイズ解放
・対称分割数追加
・オニオンスキン強化

表現系：
・粒タイプ解放（図鑑）
・色数上限拡張（依頼にも反映）
・昇り方スイッチ強化
・煙/余韻の幅UP

弟子（軽い要素）：
・管理ゲー化しない（給与/配送等は無し）
・役割：研究による解放、会話は味付け

============================================================
13. 大会（Festival）
============================================================
13.1 役割
・作品発表 7 / 金策 3
・「すごい」「きれい」を主にする（UI最小）

13.2 大会の提供方法
・カレンダーで「この時期に大会があります」
・頻度：週1目安（調整）

13.3 演目
・時間：60秒
・同時打ち：最大5（内部は微ズラしで制御可）
・構成：
　- MVP：自動構成（お気に入り優先、被り回避）
　- 拡張：手動で順番指定

13.4 大会評価
・個別花火の平均
＋多様性ボーナス
−飽きペナルティ（同じ作品/同じ大会の連打）

13.5 報酬
・評判：大きく増える（ドカン）
・金：少し

============================================================
14. 作品図鑑（Library）
============================================================
14.1 一覧
・サムネ / 名前 / 分類 / 粒タイプ / 色数 / 最高ランク
・並び替え：新しい順 / 最高ランク順 / 使用回数順
・お気に入り：大会の自動構成で優先/除外に使う

14.2 詳細
・4軸傾向（レーダー or バー）
・履歴（直近/最高）
・試射へ（いつでも確認）
・（拡張）編集して再保存

============================================================
15. クリエイティブモード（自由制作）
============================================================
15.1 ルール
・コストなし
・色数最大16
・玉サイズ自由
・提出なし（試射/保存だけでも成立）

15.2 将来（夢）
・Blueprintをエンジン非依存寄りで保存
・VRChatなどへ設計図移植できる形を目指す

============================================================
16. コンテンツ方針（粒タイプ/花火の種類）
============================================================
16.1 ゲーム内での“種類”の考え方
・花火の種類は「型（テンプレ）」＋「粒タイプ（挙動）」＋「配置（設計）」で表現する
・分類（割物/ぽか物/半割物）は入口の助け。最終的な自由度は制作操作で担保する

16.2 粒タイプ（例：MVPから段階追加）
※名称はゲーム内表現。実装は「初期条件/寿命/輝度/尾/二次バースト」で差を作る
・菊（Chrysanthemum）：基本形（放射＋減衰）
・牡丹（Peony）：太め・短め
・柳（Willow）：長寿命・垂れ（抵抗/重力の見せ方）
・椰子（Palm）：束っぽく（方向ノイズ少なめ＋速度差）
・冠（Crown）：頂点で開く感を強める（座り寄り）
・輪（Ring）：輪形状の方向セット（設計図で作れるが、補助タイプとしても）
・千輪（MultiBreak）：役物/分砲で二次バースト（拡張）
・星変化（ColorShift）：寿命中に色が変わる（発光カーブ）
・キラ（Sparkle）：点滅/粒度（描画側で表現）

※MVPは「菊＋柳＋輪」程度からでもOK（増やすほど制作が楽しくなる）

============================================================
17. セーブ／ロード
============================================================
17.1 スロット
・MVP：3スロット
・表示：Day / 所持金 / 評判 / 最終プレイ / サムネ

17.2 保存対象
・進行（Day、金、評判、解放）
・依頼キュー
・作品（Blueprint、PackedVolume、サムネ、履歴、使用回数）
・設定

17.3 バージョン管理
・Blueprint/PackedVolumeにversionを持たせ、将来の仕様変更に備える

============================================================
18. UI/UXの原則（“まったり”のため）
============================================================
・情報は必要最低限（ホームは特に少なめ）
・制作だけは濃くする（迷わない順番ガイド＋Undo）
・評価は内訳を出して“納得感”
・試射はUIを邪魔しない（美しさ優先）

============================================================
19. MVP（2か月）での実装順（推奨）
============================================================
Week1：シーン遷移（タイトル/ホーム/依頼/制作/試射/評価）＋仮UI
Week2：スライス編集（Undo/対称/オニオン）＋保存/ロード（Blueprint）
Week3：BurstSolver最小＋自前シミュ＋Particle反映（設計図→花が出る）
Week4：評価4軸（ざっくり）＋依頼一致（色/形の簡易一致）
Week5：大会（60秒/同時5/自動構成）＋作品図鑑
Week6：強化（解放）＋チュートリアル＋音/煙/風の演出
Week7：3Dフリー編集の最小版（できたら：割薬ペイント＋和紙平面）
Week8：Steam向け仕上げ（設定/パフォ/バグ潰し/ストア素材）

============================================================
20. リスクと対策（初心者向け）
============================================================
リスクA：制作UIが難しい（詰まる）
・対策：まずスライス（2D）だけでMVPを完成させる（必ず出せる）
・対策：3Dフリーは“段階解放”にして最低限から

リスクB：評価が納得できない
・対策：4軸の内訳と短いヒントを必ず出す（何が悪いか分かる）
・対策：seed固定で再現性を担保

リスクC：重い（粒数・煙）
・対策：Collision/Lightsを使わない
・対策：煙は別の低コスト表現（粒数少なめ、LOD）

============================================================
21. 用語（最小）
============================================================
・星：破裂後に飛ぶ発光粒（ゲーム内粒）
・割薬：勢い/ばらけ方/遅延に影響する“密度場”として表現する下地
・和紙：区切り壁。制作操作のための支持/形状補助
・役物：分砲など、二次バーストや塊表現を作る内部要素
・Blueprint：設計図（軽量データ）
・PackedVolume：充填データ（Voxel/密度/壁/役物、圧縮保存）
・BurstSolver：PackedVolume/Blueprintから粒の初期条件を作る計算部
・4軸：座り/盆/肩/消え口（評価の共通言語）

--- End of Document ---
